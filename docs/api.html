<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0">
    <meta name="theme-color" content="#00d4ff">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>API Reference - Hype - Zero-Dependency App Dev</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2>üöÄ Hype</h2>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="api.html" class="nav-link active">API Reference</a></li>
                <li><a href="examples.html" class="nav-link">Examples</a></li>
                <li><a href="plugins.html" class="nav-link">Plugins</a></li>
                <li><a href="https://github.com/twilson63/hype" class="nav-link">GitHub</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <section class="hero">
            <div class="container">
                <h1>API Reference</h1>
                <p class="hero-subtitle">Everything You Can Build With</p>
                <p class="hero-description">
                    All the modules, functions, and capabilities built into Hype. TUI components, HTTP servers, 
                    databases, crypto, plugins, and more‚Äîeverything you need to ship complete applications.
                </p>
            </div>
        </section>

        <section class="api-overview">
            <div class="container">
                <h2>üß© Core Modules</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">üñ•Ô∏è</div>
                        <h3>TUI Module</h3>
                        <p>Terminal User Interface components for building interactive console applications</p>
                        <a href="#tui-api" class="btn btn-secondary">View API</a>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üåê</div>
                        <h3>HTTP Module</h3>
                        <p>HTTP client and server functionality for web services and APIs</p>
                        <a href="#http-api" class="btn btn-secondary">View API</a>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üîå</div>
                        <h3>WebSocket Module</h3>
                        <p>Real-time bidirectional communication with WebSocket servers and clients</p>
                        <a href="#websocket-api" class="btn btn-secondary">View API</a>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üóÑÔ∏è</div>
                        <h3>Key-Value Module</h3>
                        <p>Embedded BoltDB database for persistent data storage</p>
                        <a href="#kv-api" class="btn btn-secondary">View API</a>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üîê</div>
                        <h3>Crypto Module</h3>
                        <p>JWK-based cryptography with RSA, ECDSA, and Ed25519 support</p>
                        <a href="#crypto-api" class="btn btn-secondary">View API</a>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üîè</div>
                        <h3>HTTP Signatures</h3>
                        <p>RFC-compliant HTTP message signing and verification</p>
                        <a href="#httpsig-api" class="btn btn-secondary">View API</a>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üß©</div>
                        <h3>Plugin System</h3>
                        <p>Extend functionality with versioned Lua modules</p>
                        <a href="#plugin-api" class="btn btn-secondary">View API</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- TUI API Section -->
        <section id="tui-api" class="api-section">
            <div class="container">
                <h2>TUI Module</h2>
                <p>The TUI module provides terminal-based user interface components using the tview library.</p>
                
                <div class="api-group">
                    <h3>Application Management</h3>
                    <div class="code-block">
                        <pre><code>local app = tui.newApp()</code></pre>
                    </div>
                    
                    <h4>App Methods</h4>
                    <ul class="api-list">
                        <li><code>app:SetRoot(primitive, fullscreen)</code> - Set the root component</li>
                        <li><code>app:Run()</code> - Start the application event loop</li>
                        <li><code>app:Stop()</code> - Stop the application</li>
                        <li><code>app:SetFocus(primitive)</code> - Set focus to a specific component</li>
                        <li><code>app:Draw()</code> - Queue a redraw</li>
                        <li><code>app:SetInputCapture(function)</code> - Set global key handler</li>
                    </ul>
                </div>

                <div class="api-group">
                    <h3>UI Components</h3>
                    
                    <h4>TextView</h4>
                    <p>Display text content with advanced formatting, styling, and scrolling capabilities.</p>
                    <div class="code-block">
                        <pre><code>local textView = tui.newTextView(text)</code></pre>
                    </div>
                    <p><strong>Content & Behavior:</strong></p>
                    <ul class="api-list">
                        <li><code>textView:SetText(text)</code> - Set display text</li>
                        <li><code>textView:GetText()</code> - Get current text</li>
                        <li><code>textView:SetWrap(bool)</code> - Enable/disable text wrapping</li>
                        <li><code>textView:SetWordWrap(bool)</code> - Enable/disable word wrapping</li>
                        <li><code>textView:SetScrollable(bool)</code> - Make content scrollable</li>
                        <li><code>textView:SetRegions(bool)</code> - Enable clickable regions</li>
                    </ul>
                    <p><strong>Enhanced Styling:</strong></p>
                    <ul class="api-list">
                        <li><code>textView:SetDynamicColors(bool)</code> - Enable color markup parsing</li>
                        <li><code>textView:SetBorder(bool)</code> - Add border around component</li>
                        <li><code>textView:SetBorderColor(color)</code> - Set border color</li>
                        <li><code>textView:SetBackgroundColor(color)</code> - Set background color</li>
                        <li><code>textView:SetTitle(title)</code> - Set component title</li>
                        <li><code>textView:SetTextColor(color)</code> - Set text color</li>
                    </ul>

                    <h4>InputField</h4>
                    <p>Text input component for user data entry with enhanced styling options.</p>
                    <div class="code-block">
                        <pre><code>local inputField = tui.newInputField()</code></pre>
                    </div>
                    <p><strong>Content & Behavior:</strong></p>
                    <ul class="api-list">
                        <li><code>inputField:SetLabel(label)</code> - Set field label</li>
                        <li><code>inputField:SetPlaceholder(text)</code> - Set placeholder text</li>
                        <li><code>inputField:GetText()</code> - Get current input text</li>
                        <li><code>inputField:SetText(text)</code> - Set input text</li>
                        <li><code>inputField:SetDoneFunc(callback)</code> - Set completion callback</li>
                    </ul>
                    <p><strong>Enhanced Styling:</strong></p>
                    <ul class="api-list">
                        <li><code>inputField:SetBorder(bool)</code> - Add border around input field</li>
                        <li><code>inputField:SetBorderColor(color)</code> - Set border color</li>
                        <li><code>inputField:SetFieldBackgroundColor(color)</code> - Set input background</li>
                        <li><code>inputField:SetFieldTextColor(color)</code> - Set input text color</li>
                        <li><code>inputField:SetTitle(title)</code> - Set component title</li>
                    </ul>

                    <h4>Button</h4>
                    <p>Clickable button component for user actions with professional styling.</p>
                    <div class="code-block">
                        <pre><code>local button = tui.newButton(label)</code></pre>
                    </div>
                    <p><strong>Content & Behavior:</strong></p>
                    <ul class="api-list">
                        <li><code>button:SetLabel(label)</code> - Set button label</li>
                        <li><code>button:SetSelectedFunc(callback)</code> - Set click handler</li>
                    </ul>
                    <p><strong>Enhanced Styling:</strong></p>
                    <ul class="api-list">
                        <li><code>button:SetBorder(bool)</code> - Add border around button</li>
                        <li><code>button:SetBorderColor(color)</code> - Set border color</li>
                        <li><code>button:SetBackgroundColor(color)</code> - Set button background</li>
                        <li><code>button:SetLabelColor(color)</code> - Set button text color</li>
                        <li><code>button:SetTitle(title)</code> - Set component title</li>
                    </ul>

                    <h4>Flex</h4>
                    <p>Flexible layout container for organizing components with styling support.</p>
                    <div class="code-block">
                        <pre><code>local flex = tui.newFlex()</code></pre>
                    </div>
                    <p><strong>Layout & Behavior:</strong></p>
                    <ul class="api-list">
                        <li><code>flex:SetDirection(direction)</code> - Set layout direction (0=vertical, 1=horizontal)</li>
                        <li><code>flex:AddItem(primitive, fixedSize, proportion, focus)</code> - Add component to layout</li>
                    </ul>
                    <p><strong>Enhanced Styling:</strong></p>
                    <ul class="api-list">
                        <li><code>flex:SetBorder(bool)</code> - Add border around container</li>
                        <li><code>flex:SetBorderColor(color)</code> - Set border color</li>
                        <li><code>flex:SetBackgroundColor(color)</code> - Set container background</li>
                        <li><code>flex:SetTitle(title)</code> - Set container title</li>
                    </ul>
                </div>

                <div class="api-group">
                    <h3>Color Styling & Theming</h3>
                    <p>Enhanced TUI components support professional color schemes and markup.</p>
                    
                    <h4>Color Constants (256-color palette)</h4>
                    <div class="code-block">
                        <pre><code>-- Common color constants for consistent theming
local COLORS = {
    PRIMARY = 39,      -- Bright blue
    SUCCESS = 46,      -- Bright green  
    WARNING = 226,     -- Bright yellow
    DANGER = 196,      -- Bright red
    SECONDARY = 245,   -- Light gray
    DARK = 235,        -- Dark gray
    DARKER = 232,      -- Very dark gray
    LIGHT = 255,       -- White
    ACCENT = 201,      -- Bright magenta
    INFO = 51          -- Bright cyan
}</code></pre>
                    </div>
                    
                    <h4>Dynamic Color Markup</h4>
                    <p>Use color markup in text content when <code>SetDynamicColors(true)</code> is enabled:</p>
                    <div class="code-block">
                        <pre><code>-- Color markup format: [color_code]text[reset_color]
textView:SetDynamicColors(true)
textView:SetText("[46]SUCCESS:[255] Operation completed!")

-- Advanced example with multiple colors
local statusText = string.format([[
[%d]üéâ Welcome to Dashboard![%d]

[%d]Status:[%d] %s
[%d]Uptime:[%d] %s
]], 
    COLORS.PRIMARY, COLORS.LIGHT,
    COLORS.INFO, COLORS.LIGHT, "Online",
    COLORS.SUCCESS, COLORS.LIGHT, "2 days"
)</code></pre>
                    </div>
                    
                    <h4>Professional Styling Example</h4>
                    <div class="code-block">
                        <pre><code>-- Create a professionally styled component
local panel = tui.newTextView("")
panel:SetDynamicColors(true)
panel:SetBorder(true)
panel:SetTitle("üìä System Metrics")
panel:SetBorderColor(COLORS.INFO)
panel:SetBackgroundColor(COLORS.DARK)
panel:SetScrollable(true)

-- Button with custom styling
local button = tui.newButton("üöÄ Execute")
button:SetBorder(true)
button:SetBorderColor(COLORS.SUCCESS)
button:SetBackgroundColor(COLORS.SUCCESS)
button:SetLabelColor(COLORS.LIGHT)</code></pre>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Event Handling</h3>
                    <p>Event objects in input capture callbacks provide:</p>
                    <ul class="api-list">
                        <li><code>event:Key()</code> - Get key code</li>
                        <li><code>event:Rune()</code> - Get character rune</li>
                    </ul>
                    
                    <div class="example-card">
                        <h4>Example: Enhanced TUI App</h4>
                        <div class="code-block">
                            <pre><code>local app = tui.newApp()
local textView = tui.newTextView("[39]Hello from Hype![255]")
textView:SetDynamicColors(true)
textView:SetBorder(true)
textView:SetTitle("üöÄ My Enhanced App")
textView:SetBorderColor(39) -- Blue border
textView:SetBackgroundColor(235) -- Dark background

app:SetInputCapture(function(event)
    if event:Key() == 27 then -- ESC key
        app:Stop()
        return nil
    end
    return event
end)

app:SetRoot(textView, true)
app:Run()</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- HTTP API Section -->
        <section id="http-api" class="api-section">
            <div class="container">
                <h2>HTTP Module</h2>
                <p>Provides HTTP client and server functionality for web services and API development.</p>
                
                <div class="api-group">
                    <h3>HTTP Client</h3>
                    <div class="code-block">
                        <pre><code>local http = require('http')</code></pre>
                    </div>
                    
                    <h4>GET Requests</h4>
                    <div class="code-block">
                        <pre><code>local response, err = http.get(url, options)</code></pre>
                    </div>
                    <p><strong>Parameters:</strong></p>
                    <ul class="api-list">
                        <li><code>url</code> - Target URL string</li>
                        <li><code>options</code> - Optional table with:
                            <ul>
                                <li><code>timeout</code> - Request timeout in seconds</li>
                                <li><code>headers</code> - Custom headers table</li>
                            </ul>
                        </li>
                    </ul>
                    
                    <p><strong>Response Structure:</strong></p>
                    <div class="code-block">
                        <pre><code>{
  status = 200,
  body = "response body",
  headers = { ["Content-Type"] = "application/json" }
}</code></pre>
                    </div>
                    
                    <div class="example-card">
                        <h4>Example: HTTP Client Usage</h4>
                        <div class="code-block">
                            <pre><code>local http = require('http')
local response, err = http.get("https://api.example.com/data", {
    timeout = 10,
    headers = {["User-Agent"] = "MyApp/1.0"}
})

if response then
    print("Status:", response.status)
    print("Body:", response.body)
else
    print("Error:", err)
end</code></pre>
                        </div>
                    </div>
                </div>

                <div class="api-group">
                    <h3>HTTP Server</h3>
                    <div class="code-block">
                        <pre><code>local server = http.newServer()</code></pre>
                    </div>
                    
                    <h4>Server Methods</h4>
                    <ul class="api-list">
                        <li><code>server:handle(pattern, handler)</code> - Register route handler</li>
                        <li><code>server:listen(port)</code> - Start server on port</li>
                        <li><code>server:stop()</code> - Stop server</li>
                    </ul>
                    
                    <h4>Handler Function</h4>
                    <p>Handler functions receive request and response objects:</p>
                    <div class="code-block">
                        <pre><code>server:handle("/api/users", function(req, res)
    -- Request object (req) contains:
    -- req.method, req.url, req.path, req.headers, req.query, req.body
    
    -- Response object (res) methods:
    res:write(content)           -- Write text response
    res:json(table)              -- Write JSON response
    res:status(code)             -- Set HTTP status code
    res:header(key, value)       -- Set response header
end)</code></pre>
                    </div>
                    
                    <div class="example-card">
                        <h4>Example: HTTP Server</h4>
                        <div class="code-block">
                            <pre><code>local http = require('http')
local server = http.newServer()

server:handle("/", function(req, res)
    res:json({ message = "Hello World!" })
end)

server:handle("/api/echo", function(req, res)
    res:json({ 
        method = req.method,
        path = req.path,
        query = req.query,
        body = req.body
    })
end)

server:listen(8080)
print("Server running on :8080")</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- WebSocket API Section -->
        <section id="websocket-api" class="api-section">
            <div class="container">
                <h2>WebSocket Module</h2>
                <p>Real-time bidirectional communication with WebSocket servers and clients for building interactive applications.</p>
                
                <div class="api-group">
                    <h3>WebSocket Server</h3>
                    <div class="code-block">
                        <pre><code>local websocket = require('websocket')
local server = websocket.newServer()</code></pre>
                    </div>
                    
                    <h4>Server Methods</h4>
                    <ul class="api-list">
                        <li><code>server:handle(path, handler)</code> - Register WebSocket route handler</li>
                        <li><code>server:listen(port)</code> - Start server on port</li>
                        <li><code>server:stop()</code> - Stop server gracefully</li>
                    </ul>
                    
                    <h4>Connection Handler</h4>
                    <p>Route handlers receive a WebSocket connection object:</p>
                    <div class="code-block">
                        <pre><code>server:handle("/ws", function(conn)
    -- Set up event handlers for this connection
    conn:onMessage(function(message)
        print("Received:", message.data)
        conn:send("Echo: " .. message.data)
    end)
    
    conn:onClose(function()
        print("Connection closed")
    end)
    
    conn:onError(function(err)
        print("Error:", err)
    end)
    
    -- Send welcome message
    conn:send("Connected to WebSocket server!")
end)</code></pre>
                    </div>
                    
                    <div class="example-card">
                        <h4>Example: WebSocket Echo Server</h4>
                        <div class="code-block">
                            <pre><code>local websocket = require('websocket')
local server = websocket.newServer()

server:handle("/echo", function(conn)
    print("New WebSocket connection")
    
    conn:onMessage(function(message)
        print("Received:", message.data)
        -- Echo message back to client
        conn:send("Echo: " .. message.data)
    end)
    
    conn:onClose(function()
        print("Client disconnected")
    end)
    
    conn:onError(function(err)
        print("WebSocket error:", err)
    end)
    
    -- Send welcome message
    conn:send("Welcome to echo server!")
end)

server:listen(8080)
print("WebSocket server running at ws://localhost:8080/echo")

-- Keep server running
while true do
    os.execute("sleep 1")
end</code></pre>
                        </div>
                    </div>
                </div>

                <div class="api-group">
                    <h3>WebSocket Client</h3>
                    <div class="code-block">
                        <pre><code>local client = websocket.connect(url)</code></pre>
                    </div>
                    
                    <p><strong>Parameters:</strong></p>
                    <ul class="api-list">
                        <li><code>url</code> - WebSocket URL (e.g., "ws://localhost:8080/ws")</li>
                    </ul>
                    
                    <p><strong>Returns:</strong> WebSocket connection object or nil on failure</p>
                    
                    <div class="example-card">
                        <h4>Example: WebSocket Client</h4>
                        <div class="code-block">
                            <pre><code>local websocket = require('websocket')
local client = websocket.connect("ws://localhost:8080/echo")

if not client then
    print("Failed to connect to WebSocket server")
    os.exit(1)
end

-- Set up event handlers
client:onMessage(function(message)
    print("Received:", message.data)
    print("Type:", message.type)  -- "text" or "binary"
end)

client:onClose(function()
    print("Connection closed")
end)

client:onError(function(err)
    print("WebSocket error:", err)
end)

-- Send messages
client:send("Hello from Lua client!")
client:sendBinary("Binary message")

-- Ping the server
client:ping()

-- Close when done
client:close()</code></pre>
                        </div>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Connection Methods</h3>
                    <p>Both server and client connections support these methods:</p>
                    <ul class="api-list">
                        <li><code>conn:send(message)</code> - Send text message</li>
                        <li><code>conn:sendBinary(data)</code> - Send binary message</li>
                        <li><code>conn:onMessage(handler)</code> - Set message event handler</li>
                        <li><code>conn:onClose(handler)</code> - Set close event handler</li>
                        <li><code>conn:onError(handler)</code> - Set error event handler</li>
                        <li><code>conn:close()</code> - Close connection</li>
                        <li><code>conn:ping()</code> - Send ping frame</li>
                    </ul>
                    
                    <h4>Message Object Structure</h4>
                    <div class="code-block">
                        <pre><code>{
  data = "message content",  -- String content of the message
  type = "text"              -- "text" or "binary"
}</code></pre>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Real-Time Chat Example</h3>
                    <div class="example-card">
                        <h4>Multi-Client Chat Server</h4>
                        <div class="code-block">
                            <pre><code>local websocket = require('websocket')
local clients = {}

local server = websocket.newServer()

server:handle("/chat", function(conn)
    -- Add client to list
    table.insert(clients, conn)
    local clientId = #clients
    print("Client " .. clientId .. " connected")
    
    -- Broadcast join message
    for i, client in ipairs(clients) do
        if client ~= conn then
            client:send("Client " .. clientId .. " joined")
        end
    end
    
    conn:onMessage(function(message)
        local msg = "Client " .. clientId .. ": " .. message.data
        print(msg)
        
        -- Broadcast to all clients
        for i, client in ipairs(clients) do
            client:send(msg)
        end
    end)
    
    conn:onClose(function()
        -- Remove client from list
        for i, client in ipairs(clients) do
            if client == conn then
                table.remove(clients, i)
                break
            end
        end
        
        -- Notify others
        for i, client in ipairs(clients) do
            client:send("Client " .. clientId .. " left")
        end
    end)
end)

server:listen(8080)
print("Chat server running at ws://localhost:8080/chat")</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Key-Value API Section -->
        <section id="kv-api" class="api-section">
            <div class="container">
                <h2>Key-Value Module</h2>
                <p>BoltDB-based embedded database for persistent storage with ACID transactions.</p>
                
                <div class="api-group">
                    <h3>Database Connection</h3>
                    <div class="code-block">
                        <pre><code>local kv = require('kv')
local db, err = kv.open(path, options)</code></pre>
                    </div>
                    <p><strong>Parameters:</strong></p>
                    <ul class="api-list">
                        <li><code>path</code> - Database file path</li>
                        <li><code>options</code> - Optional configuration table</li>
                    </ul>
                </div>

                <div class="api-group">
                    <h3>Bucket Management</h3>
                    <ul class="api-list">
                        <li><code>db:open_db(bucketName)</code> - Create/open bucket</li>
                    </ul>
                    <p>Buckets are like tables in traditional databases, used to organize key-value pairs.</p>
                </div>

                <div class="api-group">
                    <h3>Basic Operations</h3>
                    <ul class="api-list">
                        <li><code>db:put(bucket, key, value)</code> - Store key-value pair</li>
                        <li><code>db:get(bucket, key)</code> - Retrieve value by key</li>
                        <li><code>db:delete(bucket, key)</code> - Delete key</li>
                        <li><code>db:close()</code> - Close database connection</li>
                    </ul>
                    
                    <div class="example-card">
                        <h4>Example: Basic Usage</h4>
                        <div class="code-block">
                            <pre><code>local kv = require('kv')
local db, err = kv.open("./data.db")

if not db then
    print("Error opening database:", err)
    return
end

-- Create/open bucket
db:open_db("users")

-- Store data
db:put("users", "john", "John Doe")
db:put("users", "jane", "Jane Smith")

-- Retrieve data
local name = db:get("users", "john")
print("User:", name)  -- Output: User: John Doe

-- Delete data
db:delete("users", "john")

-- Close database
db:close()</code></pre>
                        </div>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Batch Operations</h3>
                    <ul class="api-list">
                        <li><code>db:keys(bucket, prefix)</code> - Get all keys (optionally with prefix)</li>
                        <li><code>db:foreach(bucket, callback)</code> - Iterate over all key-value pairs</li>
                    </ul>
                    
                    <div class="example-card">
                        <h4>Example: Batch Operations</h4>
                        <div class="code-block">
                            <pre><code>-- Get all keys
local keys = db:keys("users")
for i, key in ipairs(keys) do
    print("Key:", key)
end

-- Get keys with prefix
local userKeys = db:keys("users", "user_")

-- Iterate over all key-value pairs
db:foreach("users", function(key, value)
    print(key .. " = " .. value)
    return true  -- Continue iteration
end)</code></pre>
                        </div>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Transaction Support</h3>
                    <p>Transactions provide ACID guarantees for multiple operations.</p>
                    <div class="code-block">
                        <pre><code>local txn, err = db:begin_txn(readonly)</code></pre>
                    </div>
                    
                    <h4>Transaction Methods</h4>
                    <ul class="api-list">
                        <li><code>txn:put(bucket, key, value)</code> - Store in transaction</li>
                        <li><code>txn:get(bucket, key)</code> - Retrieve in transaction</li>
                        <li><code>txn:delete(bucket, key)</code> - Delete in transaction</li>
                        <li><code>txn:commit()</code> - Commit transaction</li>
                        <li><code>txn:abort()</code> - Abort transaction</li>
                    </ul>
                    
                    <div class="example-card">
                        <h4>Example: Transactions</h4>
                        <div class="code-block">
                            <pre><code>-- Begin read-write transaction
local txn, err = db:begin_txn(false)
if not txn then
    print("Error starting transaction:", err)
    return
end

-- Perform multiple operations
txn:put("users", "alice", "Alice Johnson")
txn:put("users", "bob", "Bob Wilson")

-- Get data within transaction
local alice = txn:get("users", "alice")
print("Alice:", alice)

-- Commit all changes
local success, err = txn:commit()
if not success then
    print("Transaction failed:", err)
    txn:abort()
end</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Crypto API Section -->
        <section id="crypto-api" class="api-section">
            <div class="container">
                <h2>Crypto Module</h2>
                <p>Professional-grade cryptography using JSON Web Key (JWK) format with support for RSA (including PSS), ECDSA, and Ed25519 algorithms, plus SHA-256/384/512 hashing with deep hashing support for complex data structures.</p>
                
                <div class="api-group">
                    <h3>Getting Started</h3>
                    <div class="code-block">
                        <pre><code>local crypto = require('crypto')</code></pre>
                    </div>
                    <p>The crypto module provides modern cryptographic operations using the industry-standard JWK format for key management.</p>
                </div>

                <div class="api-group">
                    <h3>Key Generation</h3>
                    <div class="code-block">
                        <pre><code>local jwk = crypto.generate_jwk(algorithm)
local jwk = crypto.generate_jwk(algorithm, key_size)  -- RSA only</code></pre>
                    </div>
                    
                    <p><strong>Supported Algorithms:</strong></p>
                    <ul class="api-list">
                        <li><code>"RS256", "RS384", "RS512"</code> - RSA PKCS#1 v1.5 with SHA-256/384/512</li>
                        <li><code>"PS256", "PS384", "PS512"</code> - RSA-PSS with SHA-256/384/512</li>
                        <li><code>"ES256", "ES384", "ES512"</code> - ECDSA with SHA-256/384/512</li>
                        <li><code>"EdDSA"</code> - Ed25519 (EdDSA)</li>
                    </ul>
                    
                    <p><strong>Returns:</strong> JWK table with algorithm-specific fields</p>
                    
                    <div class="example-card">
                        <h4>Example: Generate Different Key Types</h4>
                        <div class="code-block">
                            <pre><code>-- Generate RSA key (default 2048-bit)
local rsa_key = crypto.generate_jwk("RS256")
print("RSA Key Type:", rsa_key.kty)  -- "RSA"

-- Generate 4096-bit RSA key
local rsa_4096 = crypto.generate_jwk("RS256", 4096)
print("Generated 4096-bit RSA key")

-- Generate 3072-bit RSA-PSS key
local rsa_pss = crypto.generate_jwk("PS256", 3072)
print("Generated 3072-bit RSA-PSS key")

-- Generate ECDSA key  
local ecdsa_key = crypto.generate_jwk("ES256")
print("ECDSA Key Type:", ecdsa_key.kty)  -- "EC"

-- Generate Ed25519 key
local ed25519_key = crypto.generate_jwk("EdDSA")
print("Ed25519 Key Type:", ed25519_key.kty)  -- "OKP"</code></pre>
                        </div>
                        
                        <p><strong>RSA Key Sizes:</strong></p>
                        <ul class="api-list">
                            <li><code>2048</code> - Default for RS256/PS256</li>
                            <li><code>3072</code> - Default for RS384/RS512/PS384/PS512</li>
                            <li><code>4096</code> - Maximum supported size for enhanced security</li>
                        </ul>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Digital Signatures</h3>
                    
                    <h4>Signing</h4>
                    <div class="code-block">
                        <pre><code>local signature = crypto.sign(jwk, message)</code></pre>
                    </div>
                    <p><strong>Parameters:</strong></p>
                    <ul class="api-list">
                        <li><code>jwk</code> - Private JWK key (from generate_jwk)</li>
                        <li><code>message</code> - String data to sign</li>
                    </ul>
                    <p><strong>Returns:</strong> Binary signature string or nil on error</p>
                    
                    <h4>Verification</h4>
                    <div class="code-block">
                        <pre><code>local is_valid = crypto.verify(public_jwk, message, signature)</code></pre>
                    </div>
                    <p><strong>Parameters:</strong></p>
                    <ul class="api-list">
                        <li><code>public_jwk</code> - Public JWK key (from jwk_to_public)</li>
                        <li><code>message</code> - Original string data</li>
                        <li><code>signature</code> - Binary signature to verify</li>
                    </ul>
                    <p><strong>Returns:</strong> Boolean validation result</p>
                    
                    <div class="example-card">
                        <h4>Example: Sign and Verify</h4>
                        <div class="code-block">
                            <pre><code>local crypto = require('crypto')

-- Generate key pair
local private_key = crypto.generate_jwk("ES256")
local public_key = crypto.jwk_to_public(private_key)

-- Sign message
local message = "Important document content"
local signature = crypto.sign(private_key, message)

if signature then
    print("‚úÖ Message signed successfully")
    
    -- Verify signature
    local is_valid = crypto.verify(public_key, message, signature)
    
    if is_valid then
        print("‚úÖ Signature verified!")
    else
        print("‚ùå Invalid signature")
    end
else
    print("‚ùå Signing failed")
end</code></pre>
                        </div>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Key Management</h3>
                    
                    <h4>Extract Public Key</h4>
                    <div class="code-block">
                        <pre><code>local public_jwk = crypto.jwk_to_public(private_jwk)</code></pre>
                    </div>
                    <p>Extracts the public key component from a private JWK for sharing and verification.</p>
                    
                    <h4>Key Thumbprint</h4>
                    <div class="code-block">
                        <pre><code>local thumbprint = crypto.jwk_thumbprint(jwk)</code></pre>
                    </div>
                    <p>Generates a unique SHA-256 thumbprint for key identification (RFC 7638).</p>
                    
                    <h4>JSON Serialization</h4>
                    <div class="code-block">
                        <pre><code>-- Export to JSON
local json_string = crypto.jwk_to_json(jwk)

-- Import from JSON
local jwk = crypto.jwk_from_json(json_string)</code></pre>
                    </div>
                    <p>Convert JWK objects to/from JSON for storage and transmission.</p>
                    
                    <div class="example-card">
                        <h4>Example: Key Management</h4>
                        <div class="code-block">
                            <pre><code>local crypto = require('crypto')

-- Generate and manage keys
local private_key = crypto.generate_jwk("RS256")
local public_key = crypto.jwk_to_public(private_key)

-- Get unique identifier
local key_id = crypto.jwk_thumbprint(private_key)
print("Key ID:", key_id)

-- Serialize for storage
local private_json = crypto.jwk_to_json(private_key)
local public_json = crypto.jwk_to_json(public_key)

-- Save public key for sharing
local file = io.open("public_key.json", "w")
file:write(public_json)
file:close()

-- Later: load and use
local loaded_json = io.open("public_key.json"):read("*all")
local loaded_key = crypto.jwk_from_json(loaded_json)
print("Loaded key algorithm:", loaded_key.alg)</code></pre>
                        </div>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Hashing Functions</h3>
                    
                    <h4>Basic Hash Functions</h4>
                    <div class="code-block">
                        <pre><code>local hash = crypto.sha256(data)
local hash = crypto.sha384(data)
local hash = crypto.sha512(data)</code></pre>
                    </div>
                    <p>Compute SHA-256, SHA-384, or SHA-512 hash of input data.</p>
                    <p><strong>Parameters:</strong></p>
                    <ul class="api-list">
                        <li><code>data</code> - String data to hash</li>
                    </ul>
                    <p><strong>Returns:</strong> Hexadecimal hash string</p>
                    
                    <h4>Generic Hash Function</h4>
                    <div class="code-block">
                        <pre><code>local hash = crypto.hash(algorithm, data)</code></pre>
                    </div>
                    <p><strong>Parameters:</strong></p>
                    <ul class="api-list">
                        <li><code>algorithm</code> - Hash algorithm: "sha256", "sha384", or "sha512"</li>
                        <li><code>data</code> - String data to hash</li>
                    </ul>
                    <p><strong>Returns:</strong> Hexadecimal hash string or nil + error</p>
                    
                    <h4>Deep Hash Function</h4>
                    <div class="code-block">
                        <pre><code>local hash = crypto.deep_hash(value, algorithm)</code></pre>
                    </div>
                    <p>Compute a deterministic hash of complex data structures including nested tables.</p>
                    <p><strong>Parameters:</strong></p>
                    <ul class="api-list">
                        <li><code>value</code> - Any Lua value (string, number, boolean, nil, table)</li>
                        <li><code>algorithm</code> - Optional: "sha256", "sha384", or "sha512" (defaults to "sha384")</li>
                    </ul>
                    <p><strong>Returns:</strong> Hexadecimal hash string or nil + error</p>
                    
                    <div class="example-card">
                        <h4>Example: Hashing Operations</h4>
                        <div class="code-block">
                            <pre><code>local crypto = require('crypto')

-- Basic hashing
local data = "Important data to hash"
local sha256 = crypto.sha256(data)
local sha384 = crypto.sha384(data)
local sha512 = crypto.sha512(data)

print("SHA-256:", sha256)
print("SHA-384:", sha384)
print("SHA-512:", sha512)

-- Generic hash function
local hash = crypto.hash("sha384", data)
print("Generic SHA-384:", hash)

-- Deep hashing for complex structures
local complex_data = {
    user = {
        id = 123,
        name = "Alice",
        roles = {"admin", "user"}
    },
    settings = {
        theme = "dark",
        notifications = true
    },
    timestamp = os.time()
}

-- Deep hash with SHA-384 (default)
local deep_hash = crypto.deep_hash(complex_data)
print("Deep hash:", deep_hash)

-- Deep hash with specific algorithm
local deep_sha256 = crypto.deep_hash(complex_data, "sha256")
print("Deep SHA-256:", deep_sha256)

-- Consistent hashing regardless of key order
local reordered = {
    timestamp = os.time(),
    settings = {
        notifications = true,
        theme = "dark"
    },
    user = {
        roles = {"admin", "user"},
        name = "Alice",
        id = 123
    }
}

local hash1 = crypto.deep_hash(complex_data)
local hash2 = crypto.deep_hash(reordered)
print("Hashes match:", hash1 == hash2)  -- true</code></pre>
                        </div>
                    </div>
                    
                    <div class="api-group">
                        <h3>Use Cases for Hashing</h3>
                        <ul class="api-list">
                            <li><strong>Data Integrity:</strong> Verify data hasn't been modified</li>
                            <li><strong>Cache Keys:</strong> Generate consistent keys for complex data</li>
                            <li><strong>Deduplication:</strong> Identify duplicate data structures</li>
                            <li><strong>API ETags:</strong> Generate entity tags for HTTP caching</li>
                            <li><strong>Audit Logs:</strong> Create tamper-evident records</li>
                        </ul>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Security Best Practices</h3>
                    <ul class="api-list">
                        <li><strong>Key Storage:</strong> Store private keys securely, never in plain text</li>
                        <li><strong>Algorithm Choice:</strong> Use ES256 for most applications (fast + secure)</li>
                        <li><strong>Key Rotation:</strong> Regularly rotate keys and use thumbprints for identification</li>
                        <li><strong>Public Key Sharing:</strong> Only share public keys, never private keys</li>
                        <li><strong>Message Integrity:</strong> Always verify signatures before trusting data</li>
                    </ul>
                </div>

                <div class="api-group">
                    <h3>Algorithm Comparison</h3>
                    <div class="code-block">
                        <pre><code>Performance Characteristics:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Algorithm‚îÇ Key Size    ‚îÇ Signature   ‚îÇ Performance  ‚îÇ Security  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ RS256   ‚îÇ 2048 bits   ‚îÇ 256 bytes   ‚îÇ Slower       ‚îÇ Good      ‚îÇ
‚îÇ PS256   ‚îÇ 2048 bits   ‚îÇ 256 bytes   ‚îÇ Slower       ‚îÇ Better    ‚îÇ
‚îÇ ES256   ‚îÇ 256 bits    ‚îÇ 64 bytes    ‚îÇ Fast         ‚îÇ Good      ‚îÇ
‚îÇ EdDSA   ‚îÇ 256 bits    ‚îÇ 64 bytes    ‚îÇ Fastest      ‚îÇ Good      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</code></pre>
                    </div>
                    <p><strong>Recommendations:</strong></p>
                    <ul class="api-list">
                        <li><strong>ES256:</strong> Best general-purpose choice (NIST P-256)</li>
                        <li><strong>EdDSA:</strong> Fastest performance, modern alternative</li>
                        <li><strong>PS256/384/512:</strong> Use for RSA with enhanced security (PSS padding)</li>
                        <li><strong>RS256:</strong> Use when legacy RSA compatibility is required</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- HTTP Signatures API Section -->
        <section id="httpsig-api" class="api-section">
            <div class="container">
                <h2>HTTP Signatures Module</h2>
                <p>RFC-compliant HTTP message signing and verification for secure API communication, webhooks, and microservice authentication.</p>
                
                <div class="api-group">
                    <h3>Getting Started</h3>
                    <div class="code-block">
                        <pre><code>local crypto = require('crypto')
local httpsig = require('httpsig')</code></pre>
                    </div>
                    <p>HTTP Signatures provide message-level security by cryptographically signing HTTP requests and responses using the draft-cavage-http-signatures specification.</p>
                </div>

                <div class="api-group">
                    <h3>HTTP Request Signing</h3>
                    <div class="code-block">
                        <pre><code>local signed_result = httpsig.sign(message, options)</code></pre>
                    </div>
                    
                    <p><strong>Message Structure (Request):</strong></p>
                    <div class="code-block">
                        <pre><code>{
    type = "request",
    method = "POST",           -- HTTP method
    path = "/api/users",       -- URL path
    headers = {                -- HTTP headers
        ["Host"] = "api.example.com",
        ["Content-Type"] = "application/json"
    },
    body = '{"name": "Alice"}'  -- Message body
}</code></pre>
                    </div>
                    
                    <p><strong>Signing Options:</strong></p>
                    <div class="code-block">
                        <pre><code>{
    jwk = private_key,                    -- Private JWK for signing
    key_id = "my-key-2024",              -- Key identifier
    headers = {"(request-target)", "host", "date", "digest"},  -- Headers to sign
    created = os.time(),                 -- Optional: signature creation time
    expires = os.time() + 300           -- Optional: signature expiration
}</code></pre>
                    </div>
                    
                    <p><strong>Returns:</strong> Table with signed headers or nil on error</p>
                    
                    <div class="example-card">
                        <h4>Example: Sign HTTP Request</h4>
                        <div class="code-block">
                            <pre><code>local crypto = require('crypto')
local httpsig = require('httpsig')

-- Generate signing key
local signing_key = crypto.generate_jwk("ES256")

-- Create request to sign
local request = {
    type = "request",
    method = "POST",
    path = "/api/transfer", 
    headers = {
        ["Host"] = "bank-api.com",
        ["Content-Type"] = "application/json"
    },
    body = '{"amount": 1000, "to": "account123"}'
}

-- Sign the request
local signed = httpsig.sign(request, {
    jwk = signing_key,
    key_id = "client-2024",
    headers = {"(request-target)", "host", "content-type", "digest", "date"}
})

if signed then
    print("‚úÖ Request signed successfully")
    print("Signature:", signed.headers.signature:sub(1, 50) .. "...")
    print("Digest:", signed.headers.digest)
    print("Date:", signed.headers.date)
else
    print("‚ùå Signing failed")
end</code></pre>
                        </div>
                    </div>
                </div>

                <div class="api-group">
                    <h3>HTTP Response Signing</h3>
                    <p><strong>Message Structure (Response):</strong></p>
                    <div class="code-block">
                        <pre><code>{
    type = "response",
    status = 200,              -- HTTP status code
    headers = {                -- HTTP headers
        ["Content-Type"] = "application/json",
        ["Server"] = "MyAPI/1.0"
    },
    body = '{"status": "success"}'  -- Response body
}</code></pre>
                    </div>
                    
                    <div class="example-card">
                        <h4>Example: Sign HTTP Response</h4>
                        <div class="code-block">
                            <pre><code>-- Server response signing
local server_key = crypto.generate_jwk("RS256")

local response = {
    type = "response",
    status = 201,
    headers = {
        ["Content-Type"] = "application/json",
        ["Location"] = "/api/users/123"
    },
    body = '{"id": 123, "created": true}'
}

local signed_response = httpsig.sign(response, {
    jwk = server_key,
    key_id = "server-rsa-key",
    headers = {"(status)", "content-type", "location", "digest", "date"}
})

if signed_response then
    print("‚úÖ Response signed by server")
    print("Status signed:", response.status)
end</code></pre>
                        </div>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Signature Verification</h3>
                    <div class="code-block">
                        <pre><code>local result = httpsig.verify(message, options)</code></pre>
                    </div>
                    
                    <p><strong>Verification Options:</strong></p>
                    <div class="code-block">
                        <pre><code>{
    jwk = public_key,                    -- Public JWK for verification
    required_headers = {"host", "date"}, -- Headers that must be signed
    max_age = 300                       -- Max signature age in seconds
}</code></pre>
                    </div>
                    
                    <p><strong>Returns:</strong> Verification result table</p>
                    <div class="code-block">
                        <pre><code>{
    valid = true,                       -- Boolean: signature valid
    key_id = "client-2024",            -- Key ID from signature
    algorithm = "ecdsa-256",           -- Algorithm used
    reason = "digest mismatch"         -- Error reason if invalid
}</code></pre>
                    </div>
                    
                    <div class="example-card">
                        <h4>Example: Verify Signature</h4>
                        <div class="code-block">
                            <pre><code>-- Extract public key for verification
local public_key = crypto.jwk_to_public(signing_key)

-- Verify received message
local verification = httpsig.verify(received_message, {
    jwk = public_key,
    required_headers = {"host", "content-type"},
    max_age = 300  -- 5 minutes
})

if verification.valid then
    print("‚úÖ Signature verified!")
    print("Signed by:", verification.key_id)
    print("Algorithm:", verification.algorithm)
    
    -- Process trusted message
    process_secure_request(received_message)
else
    print("‚ùå Invalid signature:", verification.reason)
    -- Reject untrusted message
    return_error("Signature verification failed")
end</code></pre>
                        </div>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Digest Operations</h3>
                    <p>Message digests ensure content integrity and are automatically included when body content is present.</p>
                    
                    <h4>Create Digest</h4>
                    <div class="code-block">
                        <pre><code>local digest = httpsig.create_digest(content, algorithm)</code></pre>
                    </div>
                    <p><strong>Parameters:</strong></p>
                    <ul class="api-list">
                        <li><code>content</code> - String content to hash</li>
                        <li><code>algorithm</code> - "sha256" or "sha512" (default: "sha256")</li>
                    </ul>
                    
                    <h4>Verify Digest</h4>
                    <div class="code-block">
                        <pre><code>local is_valid = httpsig.verify_digest(content, digest_header)</code></pre>
                    </div>
                    
                    <div class="example-card">
                        <h4>Example: Manual Digest Operations</h4>
                        <div class="code-block">
                            <pre><code>local content = '{"sensitive": "data", "amount": 5000}'

-- Create digest
local digest = httpsig.create_digest(content, "sha256")
print("Digest:", digest)  -- "SHA-256=base64encodedHash"

-- Verify digest
local is_valid = httpsig.verify_digest(content, digest)
print("Valid:", is_valid)  -- true

-- Test with tampered content
local tampered = '{"sensitive": "HACKED", "amount": 5000}'
local tampered_valid = httpsig.verify_digest(tampered, digest)
print("Tampered valid:", tampered_valid)  -- false</code></pre>
                        </div>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Security Features</h3>
                    <ul class="api-list">
                        <li><strong>Automatic Digest Creation:</strong> Body content automatically hashed and signed</li>
                        <li><strong>Tampering Detection:</strong> Modified content fails verification</li>
                        <li><strong>Replay Protection:</strong> Timestamps prevent replay attacks</li>
                        <li><strong>Flexible Headers:</strong> Sign any combination of HTTP headers</li>
                        <li><strong>Multiple Algorithms:</strong> Support for RSA, ECDSA, and Ed25519</li>
                        <li><strong>Key Identification:</strong> Key IDs enable multi-key scenarios</li>
                    </ul>
                </div>

                <div class="api-group">
                    <h3>Common Use Cases</h3>
                    
                    <h4>Webhook Security</h4>
                    <div class="code-block">
                        <pre><code>-- Sign webhook payload
local webhook_signature = httpsig.sign({
    type = "request",
    method = "POST",
    path = "/webhook",
    headers = {
        ["Host"] = "client.example.com",
        ["X-Event-Type"] = "user.created"
    },
    body = '{"user_id": 123, "event": "created"}'
}, {
    jwk = webhook_signing_key,
    key_id = "webhook-2024"
})</code></pre>
                    </div>
                    
                    <h4>API Authentication</h4>
                    <div class="code-block">
                        <pre><code>-- Client signs API request
local api_request = httpsig.sign({
    type = "request", 
    method = "GET",
    path = "/api/user/profile",
    headers = {
        ["Host"] = "api.service.com",
        ["Authorization"] = "Bearer " .. access_token
    }
}, {
    jwk = client_key,
    key_id = "client-app-2024",
    headers = {"(request-target)", "host", "authorization", "date"}
})</code></pre>
                    </div>
                    
                    <h4>Microservice Communication</h4>
                    <div class="code-block">
                        <pre><code>-- Service-to-service authentication
local service_request = httpsig.sign({
    type = "request",
    method = "POST", 
    path = "/internal/process",
    headers = {
        ["Host"] = "worker-service",
        ["X-Service-ID"] = "gateway-v1"
    },
    body = process_data
}, {
    jwk = service_key,
    key_id = "gateway-service",
    created = os.time(),
    expires = os.time() + 60  -- 1 minute expiry
})</code></pre>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Best Practices</h3>
                    <ul class="api-list">
                        <li><strong>Always Sign Critical Headers:</strong> Include host, date, and content-type</li>
                        <li><strong>Use Digest for Body Content:</strong> Include "digest" header when signing requests with bodies</li>
                        <li><strong>Set Reasonable Expiration:</strong> Use expires or max_age to prevent replay attacks</li>
                        <li><strong>Validate Required Headers:</strong> Specify required_headers in verification</li>
                        <li><strong>Key Management:</strong> Use unique key_id values and rotate keys regularly</li>
                        <li><strong>Algorithm Selection:</strong> Use ES256 for most applications (fast + secure)</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Plugin System API Section -->
        <section id="plugin-api" class="api-section">
            <div class="container">
                <h2>Plugin System</h2>
                <p>Extend Hype applications with versioned Lua modules that embed seamlessly into your executables.</p>
                
                <div class="api-group">
                    <h3>Using Plugins</h3>
                    <p>Plugins are loaded using the <code>--plugins</code> command line flag and accessed in Lua using <code>require()</code>.</p>
                    
                    <h4>Plugin Specifications</h4>
                    <ul class="api-list">
                        <li><code>fs</code> - Simple name (uses auto-discovery)</li>
                        <li><code>fs@1.0.0</code> - Name with specific version</li>
                        <li><code>myfs=./path/to/plugin</code> - Custom alias with path</li>
                        <li><code>myfs=./path/to/plugin@2.0.0</code> - Alias with path and version</li>
                    </ul>
                    
                    <div class="example-card">
                        <h4>Example: Using Plugins</h4>
                        <div class="code-block">
                            <pre><code>-- app.lua
local fs = require("fs")
local config = require("config")

-- Use filesystem plugin
local content, err = fs.readFile("data.txt")
if content then
    print("File content:", content)
else
    print("Error:", err)
end

-- Use configuration plugin
config.load("app.conf")
local port = config.get("server", "port", 8080)</code></pre>
                        </div>
                        <div class="code-block">
                            <code># Run with plugins
./hype run app.lua --plugins fs@1.0.0,config@2.1.0

# Build with embedded plugins
./hype build app.lua --plugins fs@1.0.0,config@2.1.0 -o myapp</code>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Plugin Discovery</h3>
                    <p>Hype automatically searches for plugins in conventional directories:</p>
                    <ul class="api-list">
                        <li><code>./plugins/[name]/</code> - Local plugins directory</li>
                        <li><code>./examples/plugins/[name]/</code> - Example plugins</li>
                        <li><code>./[name]-plugin/</code> - Plugin suffix convention</li>
                        <li><code>./examples/plugins/[name]-plugin/</code> - Example plugin suffix</li>
                    </ul>
                    
                    <div class="example-card">
                        <h4>Example: Plugin Directory Structure</h4>
                        <div class="code-block">
                            <pre><code>project/
‚îú‚îÄ‚îÄ app.lua
‚îú‚îÄ‚îÄ plugins/
‚îÇ   ‚îú‚îÄ‚îÄ fs/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hype-plugin.yaml
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ plugin.lua
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ hype-plugin.yaml
‚îÇ       ‚îî‚îÄ‚îÄ plugin.lua
‚îî‚îÄ‚îÄ examples/
    ‚îî‚îÄ‚îÄ plugins/
        ‚îî‚îÄ‚îÄ fs-plugin/
            ‚îú‚îÄ‚îÄ hype-plugin.yaml
            ‚îî‚îÄ‚îÄ plugin.lua</code></pre>
                        </div>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Plugin Manifest</h3>
                    <p>Each plugin requires a <code>hype-plugin.yaml</code> manifest file:</p>
                    <div class="code-block">
                        <pre><code>name: "fs"
version: "1.0.0"
type: "lua"
main: "plugin.lua"
description: "Basic filesystem operations"</code></pre>
                    </div>
                    
                    <h4>Manifest Fields</h4>
                    <ul class="api-list">
                        <li><code>name</code> - Plugin identifier (required)</li>
                        <li><code>version</code> - Semantic version string (required)</li>
                        <li><code>type</code> - Plugin type, currently only "lua" (required)</li>
                        <li><code>main</code> - Entry point file (required)</li>
                        <li><code>description</code> - Human-readable description (optional)</li>
                    </ul>
                </div>

                <div class="api-group">
                    <h3>Plugin Development</h3>
                    <p>Plugins are standard Lua modules that return a table of functions:</p>
                    
                    <div class="example-card">
                        <h4>Example: Simple Plugin</h4>
                        <div class="code-block">
                            <pre><code>-- plugin.lua
local fs = {}

function fs.readFile(path)
    local file = io.open(path, "r")
    if not file then
        return nil, "File not found: " .. path
    end
    
    local content = file:read("*all")
    file:close()
    return content, nil
end

function fs.writeFile(path, content)
    local file = io.open(path, "w")
    if not file then
        return nil, "Cannot write file: " .. path
    end
    
    file:write(content)
    file:close()
    return true, nil
end

function fs.exists(path)
    local file = io.open(path, "r")
    if file then
        file:close()
        return true
    end
    return false
end

return fs</code></pre>
                        </div>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Version Management</h3>
                    <p>Plugins support exact version matching for compatibility:</p>
                    <ul class="api-list">
                        <li><code>fs@1.0.0</code> - Exact version match required</li>
                        <li><code>fs</code> or <code>fs@latest</code> - Any version accepted</li>
                        <li>Version validation prevents compatibility issues</li>
                    </ul>
                    
                    <div class="example-card">
                        <h4>Example: Version-Specific Usage</h4>
                        <div class="code-block">
                            <pre><code># Use specific version
./hype run app.lua --plugins fs@1.0.0

# Use latest version
./hype run app.lua --plugins fs

# Multiple plugins with versions
./hype run app.lua --plugins fs@1.0.0,json@2.1.0,utils</code></pre>
                        </div>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Available Plugins</h3>
                    <p>Hype includes example plugins for common use cases:</p>
                    
                    <h4>Filesystem Plugin (fs@1.0.0)</h4>
                    <ul class="api-list">
                        <li><code>fs.readFile(path)</code> - Read file contents</li>
                        <li><code>fs.writeFile(path, content)</code> - Write file contents</li>
                        <li><code>fs.exists(path)</code> - Check file existence</li>
                        <li><code>fs.size(path)</code> - Get file size</li>
                        <li><code>fs.listDir(path)</code> - List directory contents</li>
                        <li><code>fs.mkdir(path)</code> - Create directory</li>
                    </ul>
                    
                    <h4>Enhanced Filesystem Plugin (fs@2.0.0)</h4>
                    <ul class="api-list">
                        <li>All v1.0.0 features plus:</li>
                        <li><code>fs.copyFile(src, dst)</code> - Copy file</li>
                        <li><code>fs.moveFile(src, dst)</code> - Move file</li>
                        <li><code>fs.deleteFile(path)</code> - Delete file</li>
                        <li><code>fs.version()</code> - Get plugin version</li>
                    </ul>
                    
                    <div class="example-card">
                        <h4>Example: Filesystem Operations</h4>
                        <div class="code-block">
                            <pre><code>local fs = require("fs")

-- Read configuration
local config, err = fs.readFile("config.json")
if not config then
    print("Error:", err)
    return
end

-- Create backup
local success, err = fs.copyFile("data.txt", "backup.txt")
if success then
    print("Backup created successfully")
end

-- List files
local files, err = fs.listDir("./logs")
if files then
    for _, file in ipairs(files) do
        print("Found:", file)
    end
end</code></pre>
                        </div>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Plugin Best Practices</h3>
                    <ul class="api-list">
                        <li><strong>Error Handling:</strong> Return <code>nil, error_message</code> on failure</li>
                        <li><strong>Consistent API:</strong> Follow standard Lua conventions</li>
                        <li><strong>Version Compatibility:</strong> Use semantic versioning</li>
                        <li><strong>Documentation:</strong> Include clear function descriptions</li>
                        <li><strong>Testing:</strong> Test plugins with <code>hype run</code> before building</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Command Line Interface -->
        <section id="cli-api" class="api-section">
            <div class="container">
                <h2>Command Line Interface</h2>
                <p>Build and execution options for Hype applications.</p>
                
                <div class="api-group">
                    <h3>Build Command</h3>
                    <div class="code-block">
                        <pre><code>hype build script.lua [options]</code></pre>
                    </div>
                    
                    <h4>Options</h4>
                    <ul class="api-list">
                        <li><code>-o, --output NAME</code> - Set executable name</li>
                        <li><code>--target PLATFORM</code> - Target platform (current, linux, windows, darwin)</li>
                        <li><code>--plugins LIST</code> - Comma-separated list of plugins to embed</li>
                    </ul>
                    
                    <div class="example-card">
                        <h4>Build Examples</h4>
                        <div class="code-block">
                            <pre><code># Build for current platform
hype build myapp.lua

# Specify output name
hype build myapp.lua -o myserver

# Build with plugins
hype build myapp.lua --plugins fs@1.0.0,json -o myapp

# Cross-compile for different platforms
hype build myapp.lua --target linux
hype build myapp.lua --target windows
hype build myapp.lua --target darwin</code></pre>
                        </div>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Run Command</h3>
                    <p>Run Lua scripts directly for development and testing.</p>
                    <div class="code-block">
                        <pre><code>hype run script.lua [--plugins LIST] [-- args...]</code></pre>
                    </div>
                    
                    <h4>Options</h4>
                    <ul class="api-list">
                        <li><code>--plugins LIST</code> - Comma-separated list of plugins to load</li>
                    </ul>
                    
                    <div class="example-card">
                        <h4>Run Examples</h4>
                        <div class="code-block">
                            <pre><code># Run script directly
hype run server.lua

# Run with plugins
hype run myapp.lua --plugins fs@1.0.0,json

# Pass command line arguments
hype run myapp.lua -- --port 3000 --debug

# Plugins with arguments
hype run myapp.lua --plugins fs@1.0.0 -- --debug</code></pre>
                        </div>
                    </div>
                </div>

                <div class="api-group">
                    <h3>Command Line Arguments</h3>
                    <p>Access arguments in your Lua scripts via the global <code>arg</code> table:</p>
                    <ul class="api-list">
                        <li><code>arg[0]</code> - Script/executable name</li>
                        <li><code>arg[1], arg[2], ...</code> - Command line arguments</li>
                    </ul>
                    
                    <div class="example-card">
                        <h4>Example: Argument Handling</h4>
                        <div class="code-block">
                            <pre><code>-- args.lua
print("Script name:", arg[0])
print("Number of arguments:", #arg)

for i = 1, #arg do
    print("Arg " .. i .. ":", arg[i])
end

-- Usage: hype run args.lua -- hello world 123
-- Output:
-- Script name: args.lua
-- Number of arguments: 3
-- Arg 1: hello
-- Arg 2: world
-- Arg 3: 123</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Standard Libraries -->
        <section class="api-section">
            <div class="container">
                <h2>Standard Lua Libraries</h2>
                <p>All standard Lua libraries are available in Hype applications:</p>
                
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">üåê</div>
                        <h3>Global Environment</h3>
                        <p>Access to <code>_G</code> and global functions</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üì¶</div>
                        <h3>Package System</h3>
                        <p>Module loading with <code>require()</code> and <code>package</code></p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üîÑ</div>
                        <h3>Coroutines</h3>
                        <p>Cooperative multitasking with <code>coroutine</code></p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üìã</div>
                        <h3>Table Operations</h3>
                        <p>Data structure manipulation with <code>table</code></p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üìÑ</div>
                        <h3>File I/O</h3>
                        <p>File operations with <code>io</code> library</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">‚öôÔ∏è</div>
                        <h3>System Access</h3>
                        <p>Operating system interface with <code>os</code></p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üî§</div>
                        <h3>String Processing</h3>
                        <p>Text manipulation with <code>string</code></p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üî¢</div>
                        <h3>Mathematics</h3>
                        <p>Mathematical functions with <code>math</code></p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Hype</h4>
                    <p>Lua Script to Executable Packager</p>
                    <p>Built with ‚ù§Ô∏è for developers</p>
                </div>
                <div class="footer-section">
                    <h4>Links</h4>
                    <ul>
                        <li><a href="https://github.com/twilson63/hype">GitHub Repository</a></li>
                        <li><a href="https://github.com/twilson63/hype/releases">Releases</a></li>
                        <li><a href="https://github.com/twilson63/hype/issues">Issues</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Documentation</h4>
                    <ul>
                        <li><a href="api.html">API Reference</a></li>
                        <li><a href="examples.html">Examples</a></li>
                        <li><a href="plugins.html">Plugin System</a></li>
                        <li><a href="plugin-development.html">Plugin Development</a></li>
                        <li><a href="index.html#installation">Installation</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Hype. Open source project.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    
    <style>
        .api-section {
            background: var(--terminal-bg-light);
        }
        
        .api-section:nth-child(even) {
            background: var(--terminal-bg);
        }
        
        .api-group {
            margin-bottom: 3rem;
        }
        
        .api-group h4 {
            color: var(--terminal-accent);
            margin: 2rem 0 1rem;
            font-size: 1.1rem;
        }
        
        .api-group h4::before {
            content: '### ';
            color: var(--terminal-accent-dim);
        }
        
        .api-list {
            list-style: none;
            margin-left: 0;
        }
        
        .api-list li {
            margin-bottom: 0.5rem;
            padding-left: 1.5rem;
            position: relative;
        }
        
        .api-list li::before {
            content: '‚Ä¢ ';
            color: var(--terminal-accent);
            position: absolute;
            left: 0;
        }
        
        .api-list li code {
            background: var(--terminal-bg);
            padding: 2px 6px;
            border-radius: 3px;
            color: var(--terminal-accent);
            font-size: 0.9rem;
        }
        
        .api-list ul {
            margin-top: 0.5rem;
            margin-left: 1rem;
        }
        
        .api-list ul li::before {
            content: '‚ó¶ ';
        }
    </style>
</body>
</html>